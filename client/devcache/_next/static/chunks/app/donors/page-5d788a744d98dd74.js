(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[190],{2667:(e,t,a)=>{Promise.resolve().then(a.bind(a,3905))},3905:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var l=a(5155),r=a(2115),s=a(1873),n=a(6651),o=a(1169);let i=(0,a(1847).A)("map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);var c=a(891),d=a(7859),u=a(5239),m=a(5490);function h(e){let{donors:t=[],center:a,radiusKm:s,onMarkerClick:n,heightClass:o="h-64"}=e,i=(0,r.useRef)(null),c=(0,r.useRef)(null),[d,u]=(0,r.useState)(!1),[m,h]=(0,r.useState)("light");return(0,r.useEffect)(()=>{(async()=>{if(!document.querySelector("link[data-leaflet]")){let e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",e.setAttribute("data-leaflet","true"),document.head.appendChild(e)}if(!document.querySelector("link[data-leaflet-cluster]")){let e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css",e.setAttribute("data-leaflet-cluster","true"),document.head.appendChild(e);let t=document.createElement("link");t.rel="stylesheet",t.href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css",t.setAttribute("data-leaflet-cluster","true"),document.head.appendChild(t)}let e=()=>{if(window.L){if(!window.L.markerClusterGroup&&!document.getElementById("leaflet-cluster-js")){let e=document.createElement("script");e.id="leaflet-cluster-js",e.src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js",e.async=!0,e.onload=()=>u(!0),document.body.appendChild(e);return}u(!0)}else if(!document.getElementById("leaflet-js")){let t=document.createElement("script");t.id="leaflet-js",t.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",t.async=!0,t.onload=e,document.body.appendChild(t)}};e()})()},[]),(0,r.useEffect)(()=>{if(!d)return;let e=window.L;if(!e||!c.current)return;let l=t.find(e=>{var t,a;return(null==e||null==(t=e.coords)?void 0:t.lat)!=null&&(null==e||null==(a=e.coords)?void 0:a.lng)!=null}),r=l?[l.coords.lat,l.coords.lng]:[30.0444,31.2357],o=a&&null!=a.lat&&null!=a.lng?[a.lat,a.lng]:r;if(i.current){if(i.current.setView(o),i.current._baseLayers){let{light:e,dark:t}=i.current._baseLayers;"dark"===m?(e&&i.current.hasLayer(e)&&i.current.removeLayer(e),t&&!i.current.hasLayer(t)&&t.addTo(i.current)):(t&&i.current.hasLayer(t)&&i.current.removeLayer(t),e&&!i.current.hasLayer(e)&&e.addTo(i.current))}}else{i.current=e.map(c.current,{center:o,zoom:12,scrollWheelZoom:!1});let t=e.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:"&copy; OpenStreetMap contributors &copy; CARTO"}),a=e.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{attribution:"&copy; OpenStreetMap contributors &copy; CARTO"});i.current._baseLayers={light:t,dark:a},("dark"===m?a:t).addTo(i.current)}i.current._donorLayer&&(i.current.removeLayer(i.current._donorLayer),i.current._donorLayer=null),i.current._centerLayer&&(i.current.removeLayer(i.current._centerLayer),i.current._centerLayer=null);let u=e.markerClusterGroup?e.markerClusterGroup():e.layerGroup(),h=[];if(t.forEach(t=>{var a,l,r;let s=null==t||null==(a=t.coords)?void 0:a.lat,o=null==t||null==(l=t.coords)?void 0:l.lng;if(null==s||null==o)return;h.push([s,o]);let i=e.marker([s,o],{icon:(r=t.availability,e.divIcon({className:"donor-div-icon",html:'<span style="display:inline-block;width:18px;height:18px;border-radius:50%;background:'.concat("available"===r?"#16a34a":"emergency"===r?"#dc2626":"#6b7280",';box-shadow:0 0 0 2px #fff, 0 1px 6px rgba(0,0,0,0.25);"></span>'),iconSize:[18,18],iconAnchor:[9,9],popupAnchor:[0,-10]}))}),c="".concat(t.name||"Donor"," • ").concat(t.bloodGroup||"").trim(),d=null!=t.distance?"".concat(t.distance," km"):"",m="available"===t.availability?"Available":"emergency"===t.availability?"Emergency Only":"Unavailable";i.bindPopup('<div style="font-size:13px;line-height:1.3">\n          <strong>'.concat(c,"</strong><br/>\n          ").concat(m).concat(d?" • ".concat(d):"","<br/>\n          ").concat(t.address||"","\n        </div>")),i.on("click",()=>{"function"==typeof n&&n(t)}),u.addLayer(i)}),u.addTo(i.current),i.current._donorLayer=u,a&&null!=a.lat&&null!=a.lng){let t=e.layerGroup(),l=e.circleMarker([a.lat,a.lng],{radius:6,color:"#2563eb",weight:2,fillColor:"#3b82f6",fillOpacity:.8});if(t.addLayer(l),s&&Number(s)>0){let l=e.circle([a.lat,a.lng],{radius:1e3*Number(s),color:"#2563eb",weight:1.5,fillColor:"#60a5fa",fillOpacity:.15});t.addLayer(l)}t.addTo(i.current),i.current._centerLayer=t}if(h.length>=2){let t=e.latLngBounds(h);i.current.fitBounds(t,{padding:[20,20]})}return()=>{}},[d,t,a,s,n,m]),(0,l.jsxs)("div",{className:"relative rounded-isf overflow-hidden ".concat(o),children:[(0,l.jsx)("div",{ref:c,className:"w-full h-full","aria-label":"Donor map"}),(0,l.jsxs)("div",{className:"absolute top-2 left-2 bg-white/90 backdrop-blur rounded-isf shadow-isf flex items-center space-x-1 p-1",children:[(0,l.jsx)("button",{onClick:()=>h("light"),className:"px-2 py-1 text-xs rounded-isf ".concat("light"===m?"bg-primary text-white":"text-gray-700 hover:bg-gray-100"),"aria-label":"Light map",children:"Light"}),(0,l.jsx)("button",{onClick:()=>h("dark"),className:"px-2 py-1 text-xs rounded-isf ".concat("dark"===m?"bg-primary text-white":"text-gray-700 hover:bg-gray-100"),"aria-label":"Dark map",children:"Dark"})]})]})}function p(){let[e,t]=(0,r.useState)(!1),a=["/assets/hero-blood-donation-scene.png","/assets/hero-blood-donation-center.png"],[p,f]=(0,r.useState)(0),[y,x]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(t(!0),y)return;let e=setInterval(()=>{f(e=>(e+1)%a.length)},3500);return()=>clearInterval(e)},[y,a.length]);let[g,b]=(0,r.useState)(null),[v,j]=(0,r.useState)(!1),[w,N]=(0,r.useState)(""),[k,L]=(0,r.useState)(""),[C,S]=(0,r.useState)(50),[E,A]=(0,r.useState)("all"),[G,_]=(0,r.useState)("list"),[O,M]=(0,r.useState)([]),[B,D]=(0,r.useState)(!1),[T,I]=(0,r.useState)(null),[V,z]=(0,r.useState)(null),[J,P]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{D(!0),I(null);try{var e;let t=await m.Ay.get("/donors/top",{params:k?{bloodType:k}:void 0});M((null==t||null==(e=t.data)?void 0:e.donors)||[])}catch(e){I(e.message||"Failed to load donors")}finally{D(!1)}})()},[k]),(0,r.useEffect)(()=>{try{let e=JSON.parse(localStorage.getItem("isf:lastLocationSelection")||"null");(null==e?void 0:e.coords)&&z(e.coords),(null==e?void 0:e.label)&&P(e.label)}catch(e){}},[]),(0,r.useEffect)(()=>{try{let e=JSON.parse(localStorage.getItem("isf:lastBloodGroupSelection")||"null");(null==e?void 0:e.bloodGroup)!=null&&L(e.bloodGroup||"")}catch(e){}},[]),(0,r.useEffect)(()=>{let e=e=>{try{let t=(null==e?void 0:e.detail)||{};t.coords&&z(t.coords),t.label&&P(t.label)}catch(e){}};return window.addEventListener("isf:locationSelection",e),()=>window.removeEventListener("isf:locationSelection",e)},[]),(0,r.useEffect)(()=>{let e=e=>{try{var t;let a=null==e||null==(t=e.detail)?void 0:t.bloodGroup;L(a||"")}catch(e){}};return window.addEventListener("isf:bloodGroupSelection",e),()=>window.removeEventListener("isf:bloodGroupSelection",e)},[]),(0,r.useEffect)(()=>{let e=e=>{try{if("isf:lastLocationSelection"===e.key){let t=JSON.parse(e.newValue||"null");(null==t?void 0:t.coords)&&z(t.coords),(null==t?void 0:t.label)&&P(t.label)}else if("isf:lastBloodGroupSelection"===e.key){let t=JSON.parse(e.newValue||"null");(null==t?void 0:t.bloodGroup)!=null&&L(t.bloodGroup||"")}}catch(e){}};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);let R=async()=>{D(!0),I(null);try{var e,t;if(V){let t=await m.Ay.get("/donors/search",{params:{lat:V.lat,lng:V.lng,radiusKm:C,bloodType:k||void 0,availability:"all"!==E?E:void 0}});M((null==t||null==(e=t.data)?void 0:e.results)||[])}else{let e=await m.Ay.get("/donors/top",{params:k?{bloodType:k}:void 0});M((null==e||null==(t=e.data)?void 0:t.donors)||[])}}catch(e){I(e.message||"Search failed")}finally{D(!1)}};(0,r.useEffect)(()=>{V&&R()},[V,C,k,E]);let K=O.filter(e=>{let t=e.name.toLowerCase().includes(w.toLowerCase())||(e.address||"").toLowerCase().includes(w.toLowerCase()),a=!k||e.bloodGroup===k,l=null==e.distance||e.distance<=C,r="all"===E||e.availability===E;return t&&a&&l&&r}),q=e=>{b(e),j(!0)};return(0,l.jsxs)("div",{className:"min-h-screen bg-background py-8",children:[(0,l.jsxs)("div",{className:"max-w-7xl mx-auto mt-14 md:mt-0 lg:mt-0 px-4 sm:px-6 lg:px-8 transition-all duration-500 ease-out ".concat(e?"opacity-100 translate-y-0":"opacity-0 translate-y-1"),children:[(0,l.jsxs)("div",{className:"mb-8 transition-all duration-500 ease-out ".concat(e?"opacity-100 translate-y-0":"opacity-0 translate-y-1"),children:[(0,l.jsx)("h1",{className:"text-3xl font-heading font-bold text-text-primary mb-2",children:"Find Blood Donors"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Connect with verified blood donors in your area"})]}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsxs)("div",{className:"relative rounded-isf-lg overflow-hidden shadow-isf bg-white h-40 sm:h-52 lg:h-64",onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:[a.map((e,t)=>(0,l.jsx)(u.default,{src:e,alt:"Join the community of blood donors",width:1600,height:400,priority:0===t,className:"absolute inset-0 w-full h-full object-cover transition-opacity duration-700 ease-in-out transform will-change-transform ".concat(t===p?"opacity-100 scale-[1.03]":"opacity-0 scale-100")},"".concat(e,"-").concat(t))),(0,l.jsx)("div",{className:"absolute inset-x-0 bottom-0 h-10 bg-gradient-to-t from-black/10 to-transparent pointer-events-none"}),(0,l.jsx)("div",{className:"absolute bottom-2 left-0 right-0 flex justify-center gap-1.5",children:a.map((e,t)=>(0,l.jsx)("button",{"aria-label":"Go to slide ".concat(t+1),className:"w-1.5 h-1.5 rounded-full transition-transform duration-200 ease-out ".concat(t===p?"bg-primary":"bg-gray-300"),onClick:()=>f(t),style:{transform:t===p?"scale(1.4)":"scale(1)"}},"dot-".concat(t)))})]}),(0,l.jsxs)("div",{className:"mt-4 flex items-center gap-3",children:[(0,l.jsx)("button",{onClick:R,className:"bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-isf text-sm font-medium transition-colors duration-200",children:"Search Donors"}),(0,l.jsx)("button",{onClick:()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{z({lat:e.coords.latitude,lng:e.coords.longitude})},e=>{console.error("Error getting location:",e)})},className:"border border-gray-300 hover:border-primary hover:text-primary px-4 py-2 rounded-isf text-sm font-medium transition-colors duration-200",children:"Use my location"}),B&&(0,l.jsx)("span",{className:"text-sm text-gray-500",children:"Loading…"}),T&&(0,l.jsx)("span",{className:"text-sm text-red-600",children:T})]})]}),(0,l.jsx)("div",{className:"bg-white rounded-isf-lg shadow-isf p-4 mb-6 transition-all duration-500 ease-out ".concat(e?"opacity-100 translate-y-0":"opacity-0 translate-y-1"),children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(s.A,{className:"w-5 h-5 text-primary"}),(0,l.jsx)("span",{className:"font-medium text-text-primary",children:J||"Location"}),(0,l.jsx)("button",{onClick:()=>{try{window.dispatchEvent(new CustomEvent("isf:openLocationPicker")),window.scrollTo({top:0,behavior:"smooth"})}catch(e){}},className:"text-primary hover:text-primary-dark text-sm font-medium transition-transform duration-200 hover:scale-105",children:"Change"})]}),(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:[K.length," donors found"]})]})}),(0,l.jsxs)("div",{className:"bg-white rounded-isf-lg shadow-isf p-6 mb-6 transition-all duration-500 ease-out ".concat(e?"opacity-100 translate-y-0":"opacity-0 translate-y-1"),children:[(0,l.jsxs)("div",{className:"relative mb-4",children:[(0,l.jsx)(n.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,l.jsx)("input",{type:"text",placeholder:"Search donors by location or name...",value:w,onChange:e=>N(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-isf focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow duration-200 focus:shadow-isf"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Blood Group"}),(0,l.jsxs)("select",{value:k,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-isf focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,l.jsx)("option",{value:"",children:"All Blood Groups"}),["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(e=>(0,l.jsx)("option",{value:e,children:e},e))]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Distance: ",C," km"]}),(0,l.jsx)("input",{type:"range",min:"1",max:"50",value:C,onChange:e=>S(parseInt(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Availability"}),(0,l.jsxs)("select",{value:E,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-isf focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,l.jsx)("option",{value:"all",children:"All"}),(0,l.jsx)("option",{value:"available",children:"Available"}),(0,l.jsx)("option",{value:"emergency",children:"Emergency Only"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"View Mode"}),(0,l.jsxs)("div",{className:"flex rounded-isf border border-gray-300 overflow-hidden",children:[(0,l.jsxs)("button",{onClick:()=>_("list"),className:"flex-1 px-3 py-2 text-sm font-medium transition-colors duration-200 flex items-center justify-center space-x-1 hover:scale-[1.02] ".concat("list"===G?"bg-primary text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:[(0,l.jsx)(o.A,{className:"w-4 h-4"}),(0,l.jsx)("span",{children:"List"})]}),(0,l.jsxs)("button",{onClick:()=>_("map"),className:"flex-1 px-3 py-2 text-sm font-medium transition-colors duration-200 flex items-center justify-center space-x-1 hover:scale-[1.02] ".concat("map"===G?"bg-primary text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:[(0,l.jsx)(i,{className:"w-4 h-4"}),(0,l.jsx)("span",{children:"Map"})]})]})]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 transition-all duration-500 ease-out ".concat(e?"opacity-100 translate-y-0":"opacity-0 translate-y-1"),children:[(0,l.jsx)("div",{className:"lg:col-span-2",children:"list"===G?(0,l.jsxs)("div",{className:"space-y-4",children:[B&&(0,l.jsx)("div",{className:"text-center py-4 bg-white rounded-isf-lg shadow-isf text-gray-600",children:"Loading donors…"}),T&&(0,l.jsx)("div",{className:"text-center py-4 bg-white rounded-isf-lg shadow-isf text-red-600",children:T}),K.length>0?K.map((e,t)=>(0,l.jsx)("div",{className:"transition-all duration-300 ease-out hover:translate-y-0.5 hover:shadow-isf rounded-isf",style:{transitionDelay:"".concat(40*t,"ms")},children:(0,l.jsx)(c.A,{donor:e,onViewDetails:q})},e.id)):(0,l.jsxs)("div",{className:"text-center py-12 bg-white rounded-isf-lg shadow-isf",children:[(0,l.jsx)(o.A,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No donors found"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Try adjusting your search criteria or expanding the distance range."})]})]}):(0,l.jsx)("div",{className:"bg-white rounded-isf-lg shadow-isf p-0 h-96",children:(0,l.jsx)(h,{donors:K,center:V,radiusKm:C,onMarkerClick:q,heightClass:"h-96"})})}),(0,l.jsx)("div",{className:"lg:col-span-1",children:(0,l.jsxs)("div",{className:"bg-white rounded-isf-lg shadow-isf p-6 sticky top-24 transition-all duration-500 ease-out hover:shadow-lg",children:[(0,l.jsx)("h3",{className:"font-semibold text-lg mb-4",children:"Donor Locations"}),(0,l.jsx)(h,{donors:K,center:V,radiusKm:C,onMarkerClick:q,heightClass:"h-64"}),(0,l.jsxs)("div",{className:"mt-6 space-y-3",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Available Donors"}),(0,l.jsx)("span",{className:"font-semibold text-green-600",children:K.filter(e=>"available"===e.availability).length})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Emergency Only"}),(0,l.jsx)("span",{className:"font-semibold text-red-600",children:K.filter(e=>"emergency"===e.availability).length})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Verified Donors"}),(0,l.jsx)("span",{className:"font-semibold text-blue-600",children:K.filter(e=>e.verified).length})]})]})]})})]})]}),(0,l.jsx)(d.A,{donor:g,isOpen:v,onClose:()=>{j(!1),b(null)}})]})}}},e=>{e.O(0,[756,401,569,441,493,358],()=>e(e.s=2667)),_N_E=e.O()}]);