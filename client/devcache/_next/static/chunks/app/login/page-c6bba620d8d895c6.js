(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{1847:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var r=a(2115);let l=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},n=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,r.forwardRef)((e,t)=>{let{color:a="currentColor",size:l=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:d="",children:c,iconNode:u,...m}=e;return(0,r.createElement)("svg",{ref:t,...s,width:l,height:l,stroke:a,strokeWidth:o?24*Number(i)/Number(l):i,className:n("lucide",d),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(c)?c:[c]])}),o=(e,t)=>{let a=(0,r.forwardRef)((a,s)=>{let{className:o,...d}=a;return(0,r.createElement)(i,{ref:s,iconNode:t,className:n("lucide-".concat(l(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),o),...d})});return a.displayName=l(e),a}},2334:(e,t,a)=>{"use strict";a.d(t,{E1:()=>c,L6:()=>u,gg:()=>p,q7:()=>h,tH:()=>m});var r=a(5704);let l="isf:session:v1",n=parseInt(r.env.NEXT_PUBLIC_SESSION_TTL_MS||"",10)||864e5,s=r.env.NEXT_PUBLIC_LS_SECRET||"change-me-dev";async function i(e){let t=new TextEncoder,a=await crypto.subtle.importKey("raw",t.encode(e),{name:"PBKDF2"},!1,["deriveKey"]),r=t.encode("isf-blood-salt-v1");return crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function o(e){try{let t=await i(s),a=crypto.getRandomValues(new Uint8Array(12)),r=new TextEncoder().encode(JSON.stringify(e)),l=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},t,r),n=new Uint8Array(a.byteLength+l.byteLength);return n.set(a,0),n.set(new Uint8Array(l),a.byteLength),btoa(String.fromCharCode(...n))}catch(t){return JSON.stringify({__plain:!0,data:e})}}async function d(e){try{if(e&&"string"==typeof e&&e.startsWith("{")){let t=JSON.parse(e);if(t&&t.__plain)return t.data}let t=await i(s),a=atob(e),r=Uint8Array.from(a,e=>e.charCodeAt(0)),l=r.slice(0,12),n=r.slice(12),o=await crypto.subtle.decrypt({name:"AES-GCM",iv:l},t,n),d=new TextDecoder().decode(o);return JSON.parse(d)}catch(e){return null}}async function c(e){let{user:t,token:a,extra:r}=e,s=function(e){if(!e||"object"!=typeof e)return null;let t={...e};return Object.keys(t).forEach(e=>{/password|reset|secret|salt/i.test(e)&&delete t[e]}),t}(t),i=Date.now(),d=Math.min((a?function(e){try{let t=String(e).split(".");if(3!==t.length)return null;let a=JSON.parse(atob(t[1].replace(/-/g,"+").replace(/_/g,"/")));if(a&&"number"==typeof a.exp)return 1e3*a.exp;return null}catch(e){return null}}(a):null)||i+n,i+n),c={user:s,token:a||null,extra:r||null,ts:i,exp:d};try{let e=await o(c);return window.localStorage.setItem(l,e),c}catch(e){return null}}async function u(){try{let e=window.localStorage.getItem(l);if(!e)return null;let t=await d(e);if(!t||"object"!=typeof t||!("exp"in t)||!("ts"in t))return null;return t}catch(e){return null}}async function m(){let e=await u();return!!e&&Date.now()<Number(e.exp||0)}async function h(){try{window.localStorage.removeItem(l)}catch(e){}}function p(e){if(!e)return"—";let t=String(e);return t.length<=12?"".concat(t.slice(0,4),"•••").concat(t.slice(-4)):"".concat(t.slice(0,6),"••••••").concat(t.slice(-6))}},2529:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(1847).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},3573:(e,t,a)=>{Promise.resolve().then(a.bind(a,9567))},3664:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(1847).A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},5490:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>i});var r=a(2334);let l="https://isf-blood.onrender.com/api/v1",n=new Map;async function s(e){let t,a,{method:s="GET",params:i,body:o,headers:d={},cache:c=!0,ttlMs:u=3e4,credentials:m="include"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e&&/^https?:\/\//i.test(e))t=e;else{let a=String(l||"").replace(/\/+$/,""),r=String(e||"").replace(/^\/+/,"");t="".concat(a,"/").concat(r)}let h=new URL(t);i&&Object.entries(i).forEach(e=>{let[t,a]=e;null!=a&&h.searchParams.set(t,String(a))});let p=function(e,t){let{method:a="GET",headers:r,body:l}=t||{},n=r?JSON.stringify(r):"",s=l?"string"==typeof l?l:JSON.stringify(l):"";return"".concat(a,":").concat(e,":").concat(n,":").concat(s)}(h.toString(),{method:s,headers:d,body:o});if(c&&"GET"===s){let e=n.get(p);if(e&&Date.now()-e.ts<e.ttlMs)return e.data}let f=o&&"object"==typeof o,y=await (0,r.L6)(),g=(null==y?void 0:y.token)?{Authorization:d.Authorization||"Bearer ".concat(y.token)}:{},w={method:s,headers:{"Content-Type":f?"application/json":d["Content-Type"]||"application/json",...g,...d},credentials:m};o&&(w.body=f?JSON.stringify(o):o);let x=await fetch(h.toString(),w);if((x.headers.get("content-type")||"").includes("application/json"))a=await x.json();else{let e=await x.text();try{a=JSON.parse(e)}catch(t){a={success:x.ok,message:e}}}if(!x.ok){let e=Error((null==a?void 0:a.message)||"Request failed");if(e.status=x.status,e.data=a,401===x.status||403===x.status){try{await (0,r.q7)()}catch(e){}e.code="AUTH_REQUIRED"}throw e}return c&&"GET"===s&&n.set(p,{ts:Date.now(),ttlMs:u,data:a}),a}let i={get:(e,t)=>s(e,{...t,method:"GET"}),post:(e,t,a)=>s(e,{...a,method:"POST",body:t}),patch:(e,t,a)=>s(e,{...a,method:"PATCH",body:t}),delete:(e,t)=>s(e,{...t,method:"DELETE"}),login:async(e,t)=>{var a,l,n,i,o,d;let c=await s("/auth/login",{method:"POST",body:{email:e,password:t}}),u=null!=(l=null==c?void 0:c.data)?l:c,m=null!=(o=null!=(i=null!=(n=null==u?void 0:u.user)?n:null==u||null==(a=u.data)?void 0:a.user)?i:null==u?void 0:u.data)?o:null,h=null!=(d=null==u?void 0:u.token)?d:null;return await (0,r.E1)({user:m,token:h,extra:{source:"login"}}),c},googleLogin:async e=>{var t,a,l,n,i;let o=await s("/auth/google",{method:"POST",body:{idToken:e}}),d=null!=(a=null==o?void 0:o.data)?a:o,c=null!=(n=null!=(l=null==d?void 0:d.user)?l:null==d||null==(t=d.data)?void 0:t.user)?n:null,u=null!=(i=null==d?void 0:d.token)?i:null;return await (0,r.E1)({user:c,token:u,extra:{source:"googleLogin"}}),o},me:async()=>{var e;let t=await s("/auth/me",{method:"GET"}),a=null!=(e=null==t?void 0:t.data)?e:t,l=await (0,r.L6)();return await (0,r.E1)({user:a,token:(null==l?void 0:l.token)||null,extra:{source:"me"}}),t},logout:async()=>{let e=await s("/auth/logout",{method:"GET"});return await (0,r.q7)(),e},updateMe:async e=>{var t;let a=await s("/auth/update-me",{method:"PATCH",body:e}),l=null!=(t=null==a?void 0:a.data)?t:a,n=await (0,r.L6)();return await (0,r.E1)({user:l,token:(null==n?void 0:n.token)||null,extra:{source:"updateMe"}}),a},updatePassword:e=>s("/auth/update-password",{method:"PATCH",body:e}),updatePassword:async e=>{var t,a,l,n,i,o,d;let c=await s("/auth/update-password",{method:"PATCH",body:e}),u=null!=(a=null==c?void 0:c.data)?a:c,m=null!=(n=null!=(l=null==u?void 0:u.user)?l:null==u||null==(t=u.data)?void 0:t.user)?n:null,h=null!=(i=null==u?void 0:u.token)?i:null,p=await (0,r.L6)();return await (0,r.E1)({user:null!=(o=null!=m?m:null==p?void 0:p.user)?o:null,token:null!=(d=null!=h?h:null==p?void 0:p.token)?d:null,extra:{source:"updatePassword"}}),c},addAddress:e=>s("/users/address",{method:"PUT",body:e}),deleteAddress:e=>s("/users/address/".concat(e),{method:"DELETE"}),setDefaultAddress:e=>s("/users/address/".concat(e,"/default"),{method:"PUT"}),dashboard:()=>s("/users/dashboard",{method:"GET"}),updateAvatar:async e=>{var t;let a,n=new FormData;n.append("avatar",e);let s=await (0,r.L6)(),i=(null==s?void 0:s.token)?{Authorization:"Bearer ".concat(s.token)}:{},o=String(l||"").replace(/\/+$/,""),d=await fetch("".concat(o,"/users/avatar"),{method:"PUT",body:n,headers:{...i},credentials:"include"});if((d.headers.get("content-type")||"").includes("application/json"))a=await d.json();else{let e=await d.text();try{a=JSON.parse(e)}catch(t){a={success:d.ok,message:e}}}if(!d.ok){if(401===d.status||403===d.status)try{await (0,r.q7)()}catch(e){}let e=Error((null==a?void 0:a.message)||"Avatar upload failed");throw e.status=d.status,e.data=a,e}let c=null!=(t=null==a?void 0:a.data)?t:a,u=await (0,r.L6)();return await (0,r.E1)({user:c,token:(null==u?void 0:u.token)||null,extra:{source:"updateAvatar"}}),a},listDonations:async()=>{let e=await s("/users/donations",{method:"GET"});return(null==e?void 0:e.data)||e},addDonation:async e=>{let{date:t,hospital:a,units:r}=e,l=await s("/users/donations",{method:"POST",body:{date:t,hospital:a,units:r}});return(null==l?void 0:l.data)||l},getDonor:async(e,t)=>{let a=await s("/donors/".concat(e),{method:"GET",params:t});return(null==a?void 0:a.data)||a}}},7828:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(1847).A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},9567:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var r=a(5155),l=a(2115),n=a(5490),s=a(2529),i=a(9865),o=a(3664),d=a(1847);let c=(0,d.A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),u=(0,d.A)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var m=a(7828);function h(){let[e,t]=(0,l.useState)(""),[a,d]=(0,l.useState)(""),[h,p]=(0,l.useState)(!1),[f,y]=(0,l.useState)(!1),[g,w]=(0,l.useState)(null),[x,v]=(0,l.useState)(!1),[b,j]=(0,l.useState)(!1),N=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e="google-identity-services";if(document.getElementById(e))return void j(!0);let t=document.createElement("script");t.id=e,t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.onload=()=>j(!0),document.body.appendChild(t)},[]);let k=async e=>{try{let t=null==e?void 0:e.credential;if(!t)throw Error("No Google credential received");await n.Ay.googleLogin(t),v(!0),setTimeout(()=>{window.location.href="/profile"},800)}catch(e){var t;w({general:(null==e||null==(t=e.data)?void 0:t.message)||(null==e?void 0:e.message)||"Google login failed"})}};(0,l.useEffect)(()=>{if(!b||!N.current)return;let e="999047106737-ukrh7v9nja0560f2ev66h9lnvag1bcfk.apps.googleusercontent.com";if(e)try{window.google.accounts.id.initialize({client_id:e,callback:k,ux_mode:"popup"}),window.google.accounts.id.renderButton(N.current,{theme:"outline",size:"large",text:"continue_with",shape:"rect"})}catch(e){}},[b]);let E=async t=>{t.preventDefault(),w(null);let r=(()=>{let t={};return e.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||(t.email="Enter a valid email address"):t.email="Email is required",a.trim()?a.length<6&&(t.password="Password must be at least 6 characters"):t.password="Password is required",t})();if(Object.keys(r).length)return void w(r);y(!0);try{await n.Ay.login(e.trim(),a),v(!0),setTimeout(()=>{window.location.href="/profile"},800)}catch(e){var l;w({general:(null==e||null==(l=e.data)?void 0:l.message)||(null==e?void 0:e.message)||"Login failed"})}finally{y(!1)}};return x?(0,r.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center py-6 md:py-8","aria-live":"polite",children:(0,r.jsx)("div",{className:"max-w-md mx-auto px-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-isf-lg shadow-isf p-6 md:p-8 text-center",children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mx-auto mb-4",children:(0,r.jsx)(s.A,{className:"w-8 h-8 text-green-600"})}),(0,r.jsx)("h2",{className:"text-xl md:text-2xl font-bold text-gray-900 mb-3 md:mb-4",children:"Login Successful"}),(0,r.jsx)("p",{className:"text-sm md:text-base text-gray-600 mb-5 md:mb-6",children:"Welcome back! Redirecting to your profile…"}),(0,r.jsx)("button",{onClick:()=>window.location.href="/profile",className:"w-full bg-primary hover:bg-primary-dark text-white px-6 py-3 min-h-[48px] rounded-isf font-medium transition-colors duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2",children:"Go to Profile"})]})})}):(0,r.jsx)("div",{className:"min-h-screen bg-background py-6 md:py-8 mt-14 sm:mt-0 md:mt-0",children:(0,r.jsxs)("div",{className:"max-w-md mx-auto px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"text-center mb-6 md:mb-8",children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-14 h-14 md:w-16 md:h-16 bg-primary rounded-full mx-auto mb-3 md:mb-4",children:(0,r.jsx)(i.A,{className:"w-8 h-8 text-white"})}),(0,r.jsx)("h1",{className:"text-2xl md:text-3xl font-heading font-bold text-text-primary mb-2",children:"Log in"}),(0,r.jsx)("p",{className:"text-sm md:text-base text-gray-600",children:"Access your donor profile and manage requests"})]}),(0,r.jsx)("div",{className:"bg-white rounded-isf-lg shadow-isf p-6 md:p-8",children:(0,r.jsxs)("form",{onSubmit:E,className:"space-y-5 md:space-y-6",noValidate:!0,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(o.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),(0,r.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:e,onChange:e=>t(e.target.value),placeholder:"you@example.com",className:"w-full pl-10 pr-3 py-3 min-h-[48px] border border-gray-300 rounded-isf focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2","aria-invalid":!!(null==g?void 0:g.email),"aria-describedby":(null==g?void 0:g.email)?"email-error":void 0})]}),(null==g?void 0:g.email)&&(0,r.jsx)("p",{id:"email-error",className:"mt-2 text-sm text-red-600",children:g.email})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(c,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),(0,r.jsx)("input",{id:"password",name:"password",type:h?"text":"password",autoComplete:"current-password",required:!0,value:a,onChange:e=>d(e.target.value),placeholder:"••••••••",className:"w-full pl-10 pr-11 py-3 min-h-[48px] border border-gray-300 rounded-isf focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2","aria-invalid":!!(null==g?void 0:g.password),"aria-describedby":(null==g?void 0:g.password)?"password-error":void 0}),(0,r.jsx)("button",{type:"button",onClick:()=>p(e=>!e),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 rounded-isf","aria-label":h?"Hide password":"Show password",children:h?(0,r.jsx)(u,{className:"w-5 h-5"}):(0,r.jsx)(m.A,{className:"w-5 h-5"})})]}),(null==g?void 0:g.password)&&(0,r.jsx)("p",{id:"password-error",className:"mt-2 text-sm text-red-600",children:g.password})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{id:"remember",name:"remember",type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"}),(0,r.jsx)("label",{htmlFor:"remember",className:"ml-2 block text-sm text-gray-700",children:"Remember me"})]}),(0,r.jsx)("a",{href:"#",className:"text-sm font-medium text-primary hover:text-primary-dark",children:"Forgot password?"})]}),(0,r.jsx)("button",{type:"submit",disabled:f,className:"w-full bg-primary hover:bg-primary-dark disabled:opacity-70 disabled:cursor-not-allowed text-white px-6 py-3 min-h-[48px] rounded-isf font-medium transition-colors duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2",children:f?"Signing in…":"Sign in"}),(null==g?void 0:g.general)&&(0,r.jsx)("p",{className:"mt-2 text-sm text-red-600","aria-live":"assertive",children:g.general}),(0,r.jsxs)("div",{className:"relative my-4",children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center","aria-hidden":"true",children:(0,r.jsx)("div",{className:"w-full border-t border-gray-200"})}),(0,r.jsx)("div",{className:"relative flex justify-center",children:(0,r.jsx)("span",{className:"bg-white px-3 text-sm text-gray-500",children:"or"})})]}),(0,r.jsxs)("div",{className:"w-full",children:[(0,r.jsx)("div",{ref:N,className:"flex justify-center"}),b?null:(0,r.jsx)("button",{type:"button",className:"mt-2 w-full bg-white border border-gray-300 hover:bg-gray-50 text-gray-800 px-6 py-3 min-h-[48px] rounded-isf font-medium transition-colors duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2",onClick:()=>w({general:"Google Sign-In is not configured. Set NEXT_PUBLIC_GOOGLE_CLIENT_ID."}),children:"Continue with Google"})]})]})})]})})}},9865:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(1847).A)("log-in",[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]])}},e=>{e.O(0,[441,493,358],()=>e(e.s=3573)),_N_E=e.O()}]);