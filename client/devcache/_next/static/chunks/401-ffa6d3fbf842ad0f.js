"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[401],{508:(t,e,a)=>{a.d(e,{A:()=>n});let n=(0,a(1847).A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},1169:(t,e,a)=>{a.d(e,{A:()=>n});let n=(0,a(1847).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},2334:(t,e,a)=>{a.d(e,{E1:()=>d,L6:()=>c,gg:()=>p,q7:()=>h,tH:()=>y});var n=a(5704);let l="isf:session:v1",r=parseInt(n.env.NEXT_PUBLIC_SESSION_TTL_MS||"",10)||864e5,o=n.env.NEXT_PUBLIC_LS_SECRET||"change-me-dev";async function s(t){let e=new TextEncoder,a=await crypto.subtle.importKey("raw",e.encode(t),{name:"PBKDF2"},!1,["deriveKey"]),n=e.encode("isf-blood-salt-v1");return crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:1e5,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function u(t){try{let e=await s(o),a=crypto.getRandomValues(new Uint8Array(12)),n=new TextEncoder().encode(JSON.stringify(t)),l=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},e,n),r=new Uint8Array(a.byteLength+l.byteLength);return r.set(a,0),r.set(new Uint8Array(l),a.byteLength),btoa(String.fromCharCode(...r))}catch(e){return JSON.stringify({__plain:!0,data:t})}}async function i(t){try{if(t&&"string"==typeof t&&t.startsWith("{")){let e=JSON.parse(t);if(e&&e.__plain)return e.data}let e=await s(o),a=atob(t),n=Uint8Array.from(a,t=>t.charCodeAt(0)),l=n.slice(0,12),r=n.slice(12),u=await crypto.subtle.decrypt({name:"AES-GCM",iv:l},e,r),i=new TextDecoder().decode(u);return JSON.parse(i)}catch(t){return null}}async function d(t){let{user:e,token:a,extra:n}=t,o=function(t){if(!t||"object"!=typeof t)return null;let e={...t};return Object.keys(e).forEach(t=>{/password|reset|secret|salt/i.test(t)&&delete e[t]}),e}(e),s=Date.now(),i=Math.min((a?function(t){try{let e=String(t).split(".");if(3!==e.length)return null;let a=JSON.parse(atob(e[1].replace(/-/g,"+").replace(/_/g,"/")));if(a&&"number"==typeof a.exp)return 1e3*a.exp;return null}catch(t){return null}}(a):null)||s+r,s+r),d={user:o,token:a||null,extra:n||null,ts:s,exp:i};try{let t=await u(d);return window.localStorage.setItem(l,t),d}catch(t){return null}}async function c(){try{let t=window.localStorage.getItem(l);if(!t)return null;let e=await i(t);if(!e||"object"!=typeof e||!("exp"in e)||!("ts"in e))return null;return e}catch(t){return null}}async function y(){let t=await c();return!!t&&Date.now()<Number(t.exp||0)}async function h(){try{window.localStorage.removeItem(l)}catch(t){}}function p(t){if(!t)return"—";let e=String(t);return e.length<=12?"".concat(e.slice(0,4),"•••").concat(e.slice(-4)):"".concat(e.slice(0,6),"••••••").concat(e.slice(-6))}},2529:(t,e,a)=>{a.d(e,{A:()=>n});let n=(0,a(1847).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},5229:(t,e,a)=>{a.d(e,{A:()=>n});let n=(0,a(1847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},5490:(t,e,a)=>{a.d(e,{Ay:()=>s});var n=a(2334);let l="https://isf-blood.onrender.com/api/v1",r=new Map;async function o(t){let e,a,{method:o="GET",params:s,body:u,headers:i={},cache:d=!0,ttlMs:c=3e4,credentials:y="include"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof t&&/^https?:\/\//i.test(t))e=t;else{let a=String(l||"").replace(/\/+$/,""),n=String(t||"").replace(/^\/+/,"");e="".concat(a,"/").concat(n)}let h=new URL(e);s&&Object.entries(s).forEach(t=>{let[e,a]=t;null!=a&&h.searchParams.set(e,String(a))});let p=function(t,e){let{method:a="GET",headers:n,body:l}=e||{},r=n?JSON.stringify(n):"",o=l?"string"==typeof l?l:JSON.stringify(l):"";return"".concat(a,":").concat(t,":").concat(r,":").concat(o)}(h.toString(),{method:o,headers:i,body:u});if(d&&"GET"===o){let t=r.get(p);if(t&&Date.now()-t.ts<t.ttlMs)return t.data}let w=u&&"object"==typeof u,g=await (0,n.L6)(),f=(null==g?void 0:g.token)?{Authorization:i.Authorization||"Bearer ".concat(g.token)}:{},v={method:o,headers:{"Content-Type":w?"application/json":i["Content-Type"]||"application/json",...f,...i},credentials:y};u&&(v.body=w?JSON.stringify(u):u);let m=await fetch(h.toString(),v);if((m.headers.get("content-type")||"").includes("application/json"))a=await m.json();else{let t=await m.text();try{a=JSON.parse(t)}catch(e){a={success:m.ok,message:t}}}if(!m.ok){let t=Error((null==a?void 0:a.message)||"Request failed");if(t.status=m.status,t.data=a,401===m.status||403===m.status){try{await (0,n.q7)()}catch(t){}t.code="AUTH_REQUIRED"}throw t}return d&&"GET"===o&&r.set(p,{ts:Date.now(),ttlMs:c,data:a}),a}let s={get:(t,e)=>o(t,{...e,method:"GET"}),post:(t,e,a)=>o(t,{...a,method:"POST",body:e}),patch:(t,e,a)=>o(t,{...a,method:"PATCH",body:e}),delete:(t,e)=>o(t,{...e,method:"DELETE"}),login:async(t,e)=>{var a,l,r,s,u,i;let d=await o("/auth/login",{method:"POST",body:{email:t,password:e}}),c=null!=(l=null==d?void 0:d.data)?l:d,y=null!=(u=null!=(s=null!=(r=null==c?void 0:c.user)?r:null==c||null==(a=c.data)?void 0:a.user)?s:null==c?void 0:c.data)?u:null,h=null!=(i=null==c?void 0:c.token)?i:null;return await (0,n.E1)({user:y,token:h,extra:{source:"login"}}),d},googleLogin:async t=>{var e,a,l,r,s;let u=await o("/auth/google",{method:"POST",body:{idToken:t}}),i=null!=(a=null==u?void 0:u.data)?a:u,d=null!=(r=null!=(l=null==i?void 0:i.user)?l:null==i||null==(e=i.data)?void 0:e.user)?r:null,c=null!=(s=null==i?void 0:i.token)?s:null;return await (0,n.E1)({user:d,token:c,extra:{source:"googleLogin"}}),u},me:async()=>{var t;let e=await o("/auth/me",{method:"GET"}),a=null!=(t=null==e?void 0:e.data)?t:e,l=await (0,n.L6)();return await (0,n.E1)({user:a,token:(null==l?void 0:l.token)||null,extra:{source:"me"}}),e},logout:async()=>{let t=await o("/auth/logout",{method:"GET"});return await (0,n.q7)(),t},updateMe:async t=>{var e;let a=await o("/auth/update-me",{method:"PATCH",body:t}),l=null!=(e=null==a?void 0:a.data)?e:a,r=await (0,n.L6)();return await (0,n.E1)({user:l,token:(null==r?void 0:r.token)||null,extra:{source:"updateMe"}}),a},updatePassword:t=>o("/auth/update-password",{method:"PATCH",body:t}),updatePassword:async t=>{var e,a,l,r,s,u,i;let d=await o("/auth/update-password",{method:"PATCH",body:t}),c=null!=(a=null==d?void 0:d.data)?a:d,y=null!=(r=null!=(l=null==c?void 0:c.user)?l:null==c||null==(e=c.data)?void 0:e.user)?r:null,h=null!=(s=null==c?void 0:c.token)?s:null,p=await (0,n.L6)();return await (0,n.E1)({user:null!=(u=null!=y?y:null==p?void 0:p.user)?u:null,token:null!=(i=null!=h?h:null==p?void 0:p.token)?i:null,extra:{source:"updatePassword"}}),d},addAddress:t=>o("/users/address",{method:"PUT",body:t}),deleteAddress:t=>o("/users/address/".concat(t),{method:"DELETE"}),setDefaultAddress:t=>o("/users/address/".concat(t,"/default"),{method:"PUT"}),dashboard:()=>o("/users/dashboard",{method:"GET"}),updateAvatar:async t=>{var e;let a,r=new FormData;r.append("avatar",t);let o=await (0,n.L6)(),s=(null==o?void 0:o.token)?{Authorization:"Bearer ".concat(o.token)}:{},u=String(l||"").replace(/\/+$/,""),i=await fetch("".concat(u,"/users/avatar"),{method:"PUT",body:r,headers:{...s},credentials:"include"});if((i.headers.get("content-type")||"").includes("application/json"))a=await i.json();else{let t=await i.text();try{a=JSON.parse(t)}catch(e){a={success:i.ok,message:t}}}if(!i.ok){if(401===i.status||403===i.status)try{await (0,n.q7)()}catch(t){}let t=Error((null==a?void 0:a.message)||"Avatar upload failed");throw t.status=i.status,t.data=a,t}let d=null!=(e=null==a?void 0:a.data)?e:a,c=await (0,n.L6)();return await (0,n.E1)({user:d,token:(null==c?void 0:c.token)||null,extra:{source:"updateAvatar"}}),a},listDonations:async()=>{let t=await o("/users/donations",{method:"GET"});return(null==t?void 0:t.data)||t},addDonation:async t=>{let{date:e,hospital:a,units:n}=t,l=await o("/users/donations",{method:"POST",body:{date:e,hospital:a,units:n}});return(null==l?void 0:l.data)||l},getDonor:async(t,e)=>{let a=await o("/donors/".concat(t),{method:"GET",params:e});return(null==a?void 0:a.data)||a}}},5937:(t,e,a)=>{a.d(e,{A:()=>n});let n=(0,a(1847).A)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]])},6651:(t,e,a)=>{a.d(e,{A:()=>n});let n=(0,a(1847).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])}}]);